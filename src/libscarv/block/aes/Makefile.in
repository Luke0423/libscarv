# Copyright (C) 2019 SCARV project <info@scarv.org>
#
# Use of this source code is restricted per the MIT license, a copy of which 
# can be found at https://opensource.org/licenses/MIT (or should be included 
# as LICENSE.txt within the associated archive or repository).

KERNEL          = block/aes

KERNEL_PATHS    = ${REPO_HOME}/src/libscarv/${KERNEL}/share
KERNEL_PATHS   += ${REPO_HOME}/src/libscarv/${KERNEL}/${CONF_AES_TYPE}
KERNEL_PATHS   += ${REPO_HOME}/src/libscarv/${KERNEL}/${CONF_AES_TYPE}/${ARCH}

KERNEL_HEADERS  = $(foreach PATH,${KERNEL_PATHS},$(wildcard ${PATH}/*.h))
KERNEL_SOURCES  = $(foreach PATH,${KERNEL_PATHS},$(wildcard ${PATH}/*.c))
KERNEL_SOURCES += $(foreach PATH,${KERNEL_PATHS},$(wildcard ${PATH}/*.S))

ifeq (${CONF_AES_ENC_ENABLE},0)
KERNEL_SOURCES := $(shell echo ${KERNEL_SOURCES} | tr ' ' '\n' | sed -e '/.*\(aes_enc\).*/d')
KERNEL_HEADERS := $(shell echo ${KERNEL_HEADERS} | tr ' ' '\n' | sed -e '/.*\(aes_enc\).*/d')
endif
ifeq (${CONF_AES_DEC_ENABLE},0)
KERNEL_SOURCES := $(shell echo ${KERNEL_SOURCES} | tr ' ' '\n' | sed -e '/.*\(aes_dec\).*/d')
KERNEL_HEADERS := $(shell echo ${KERNEL_HEADERS} | tr ' ' '\n' | sed -e '/.*\(aes_dec\).*/d')
endif

$(eval $(call generate,${KERNEL},${KERNEL_PATHS},${KERNEL_HEADERS},${KERNEL_SOURCES}))
